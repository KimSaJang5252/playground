<html>
	<head>
		<header>
			<title>허구연 시뮬레이터</title>
		</header>
	</head>
	<body>
		<span name="winRateBoard" id="winRateBoard"></span>
		<br>
		<input type="text" name="str" id="str">
		<button type="button" onclick="playBall($('#str').val())">플레이 볼</button>
		<button type="button" onclick="reset()">리셋</button>
		<br>
		<span name="scoreBoard" id="scoreBoard"></span>
		
		<div style=" margin-top:300px;">
			<button onclick="showDonate();">donate</button><br>
			<span id="donateMenu" style="visibility:hidden;">
				불우한 개발자에게 따스한 손길을 내밀어주세요.<br><br>
				<span style="font-weight:bold;cursor:pointer;" onclick="alert('이 개발자는 단 것을 좋아하지 않습니다.');">0.99$(가나초콜렛 세트)</span><br><br>
				<span style="font-weight:bold;cursor:pointer;" onclick="alert('이 개발자는 생선을 좋아하지 않습니다.');">24.99$(도다리회 세트)</span><br><br>
				<span style="font-weight:bold;cursor:pointer;" onclick="alert('이 개발자는 운전면허가 없습니다.');">134999.99$(포르쉐 911 세트)</span><br><br>
			</span>
		</div>
	</body>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script>
	<script>
		var numArray; // 0~9까지의 숫자 3개 들어가는 배열
		var newRandomNumber;
		var duplicated;
		var roundCnt;
		var winCnt = 0;
		var loseCnt = 0;
		var winFlag;
		
		function reset(){
			
			if(winFlag){
				winCnt++;
			}
			else{
				if(roundCnt>0){
					if(confirm("포기하는 그 순간 시합종료예요...!")){
						loseCnt++;
					}
					else{
						return;
					}
				}
				else{
					return;
				}
			}
			
			var winRate;
			
			if(loseCnt+winCnt == 0){ //0으로 나누기 에러처리
				if(winCnt>0) winRate = 1;
				else winRate = 0;
			
			}
			else{
				winRate = winCnt/(winCnt+loseCnt);
			}
			$("#winRateBoard").html(winCnt+"승 "+ loseCnt +"패 승률 : "+ (winRate*100)+"%");
			numArrayInit();
		}
		
		function numArrayInit(){ //랜덤 숫자 생성
			numArray = new Array();
			roundCnt = 0;
			winFlag = false;
			$("#scoreBoard").html("");
			$("#str").val("");
			for(i=0;i<3;i++){
			
				duplicated = true;
				while(duplicated){//이전에 뽑았던 숫자랑 중복되지 않을 때 까지 뽑음
					duplicated = false;
					newRandomNumber =Math.floor(Math.random()*10);
					for(j=0;j<i;j++){
						if(numArray[j]==newRandomNumber) duplicated = true;
						
					}
				}
				//앞의 숫자와 중복 되지 않으면 여기로 빠져나옴
				numArray[i]=newRandomNumber;
			
			}
			
			console.log(numArray);
		}
		
		function playBall(str){
		
			if(winFlag){		
				alert("이미 당신이 이겼어요.");
				return;
			}
		
			if(roundCnt>=9){		
				alert("연장전은 없습니다. 당신의 패배입니다.");
				return;
			}
			if(str.length != 3){
				alert("길이 에러입니다.");
				return;
			}
			
			for(i=0;i<3;i++){
				if(isNaN(str[i])){
					alert("숫자가 아닙니다.");
					return;
				}
				for(j=0;j<i;j++){
					if(str[j]==str[i]){
						alert("중복 숫자는 반칙입니다.");
						return;
					}
				}
				
			}
			
			var strikeCnt = 0,ballCnt = 0;
			
			for(i=0;i<3;i++){//입력한 숫자
				for(j=0;j<3;j++){//컴퓨터가 준 숫자
					if(str[i]==numArray[j]){
						if(i==j){
							strikeCnt++;
						}
						else{
							ballCnt++;
						}
					}
				}
			}
			
			roundCnt++;
			var prevScoreBoard=$("#scoreBoard").html();
			if(strikeCnt==3){
				//console.log(roundCnt+"회. 아웃!");
				$("#scoreBoard").html(prevScoreBoard+roundCnt+"회. " + str + "! 아웃!<br>");
				winFlag=true;
			}
			else{
				//console.log(roundCnt+"회. "+strikeCnt+"스트라이크 "+ballCnt+"볼");
				$("#scoreBoard").html(prevScoreBoard+roundCnt+"회. " + str +"! " +strikeCnt+"스트라이크 "+ballCnt+"볼<br>");
			}
		}
		
		numArrayInit();
		
		function showDonate(){//쓸데없는 기능
			var visibility = $("#donateMenu").css('visibility');
			if(visibility == "hidden"){
				$("#donateMenu").css('visibility','');
			}
			else{
				$("#donateMenu").css('visibility','hidden');
			}
		
		}
		
	</script>
</html>
